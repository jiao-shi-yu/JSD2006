









## 多个客户端连接到服务端

### 能不能用循环嵌套的方式？
例如：
```java
public void start() {
    try {
        while (true) {
            System.out.println("等待客户端连接");
            Socket socket = serverSocket.accept();
            System.out.println("一个客户端连接成功");
            
            InputStream in = socket.getInputStream();
            InputStreamReader isr = new InputStreamReader(in, "UTF-8");
            BufferedReader br = new BufferedReader(isr);
            
            String message = null;
            
            while((message = br.readLine()) != null) {
                
                System.out.println("客户端说：" + message);
            }
        }
    } catch (Exception e) {
        // TODO: handle exception
    }
}
```

不行。因为内层是一个死循环。一直接受第一个客户端的消息，不会跳出内层循环。除非第一个客户端断开连接。br 读到 null.



## 使用线程接收客户端请求
```java
    class ClientHandler implements Runnable {
        private Socket socket;
        public ClientHandler(Socket socket) {
            this.socket = socket;
        }
        public void run() {
            try {

                InputStream in = socket.getInputStream();
                InputStreamReader isr = new InputStreamReader(in, "UTF-8");
                BufferedReader br = new BufferedReader(isr);
                
                String message = null;
                while((message = br.readLine()) != null) {
                    System.out.println("客户端说：" + message);
                }
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
```

## 服务端向多个客户端发送消息

用一个数组，存储各个 ClientHandler 的输出流。
通过它来转发消息。
```java
private PrintWriter[] allOut = {};
```


在 ClientHandler 的 run() 方法里面，给客户端发送信息。

```java
                // 获取输出流
                OutputStream out = socket.getOutputStream();
                PrintWriter pw = new PrintWriter(out);
                
                // 将 printWriter 添加到数组中
                // 1. 扩容
                allOut = Arrays.copyOf(allOut, allOut.length+1);
                // 2. 赋值
                allOut[allOut.length-1] = pw;
                
                String message = null;
                while((message = br.readLine()) != null) {
                    for (PrintWriter writer: allOut) {
                        writer.println(message);
                    }
                }

```


## 客户端接收服务端的信息













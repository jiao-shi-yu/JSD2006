<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,d09GRgABAAAAABE0AA8AAAAAHWwAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABHU1VCAAABWAAAADsAAABUIIslek9TLzIAAAGUAAAAQwAAAFY3d1HZY21hcAAAAdgAAACqAAACOvWLi0FjdnQgAAAChAAAABMAAAAgBtX/BGZwZ20AAAKYAAAFkAAAC3CKkZBZZ2FzcAAACCgAAAAIAAAACAAAABBnbHlmAAAIMAAABdQAAAjkYT9TNWhlYWQAAA4EAAAAMwAAADYQ6WvNaGhlYQAADjgAAAAfAAAAJAc6A1pobXR4AAAOWAAAACAAAAA0Kmz/7mxvY2EAAA54AAAAHAAAABwQPBJubWF4cAAADpQAAAAgAAAAIAEHC/NuYW1lAAAOtAAAAYQAAALxhQT4h3Bvc3QAABA4AAAAfgAAAMS3SYh9cHJlcAAAELgAAAB6AAAAhuVBK7x4nGNgZGBg4GIwYLBjYHJx8wlh4MtJLMljkGJgYYAAkDwymzEnMz2RgQPGA8qxgGkOIGaDiAIAJjsFSAB4nGNgZHZmnMDAysDAVMW0h4GBoQdCMz5gMGRkAooysDIzYAUBaa4pDA4Pwz+yMwf9z2KIYg5imAYUZgTJAQDcoQvQAHic7ZHNDYJAFIRnBXf94cDRIiyCKkCpwFCPJ092RcKNDoYKcN4+EmMPvpdvk539zQyAPYBCXEUJhBcCrJ5SQ9YLnLJe4qF5rdb+uWPDngNHTkta101pNyWa8lMhn6xx2dqUnW4q9YOIhAOOeueMSgsR/6ry+P7O5s6xVNg4chBsHUuFnWNJ8uZYwrw7chrsHXkODo7cB0dHOYCTY8kv0VE2WJKD6gOlWjsxAAB4nGNgQAMSEMgc9D8LhAESbAPdAHicrVZpd9NGFB15SZyELCULLWphxMRpsEYmbMGACUGyYyBdnK2VoIsUO+m+8Ynf4F/zZNpz6Dd+Wu8bLySQtOdwmpOjd+fN1czbZRJaktgL65GUmy/F1NYmjew8CemGTctRfCg7eyFlisnfBVEQrZbatx2HREQiULWusEQQ+x5ZmmR86FFGy7akV03KLT3pLlvjQb1V334aOsqxO6GkZjN0aD2yJVUYVaJIpj1S0qZlqPorSSu8v8LMV81QwohOImm8GcbQSN4bZ7TKaDW24yiKbLLcKFIkmuFBFHmU1RLn5IoJDMoHzZDyyqcR5cP8iKzYo5xWsEu20/y+L3mndzk/sV9vUbbkQB/Ijuzg7HQlX4RbW2HctJPtKFQRdtd3QmzZ7FT/Zo/ymkYDtysyvdCMYKl8hRArP6HM/iFZLZxP+ZJHo1qykRNB62VO7Es+gdbjiClxzRhZ0N3RCRHU/ZIzDPaYPh788d4plgsTAngcy3pHJZwIEylhczRJ2jByYCVliyqp9a6YOOV1WsRbwn7t2tGXzmjjUHdiPFsPHVs5UcnxaFKnmUyd2knNoykNopR0JnjMrwMoP6JJXm1jNYmVR9M4ZsaERCICLdxLU0EsO7GkKQTNoxm9uRumuXYtWqTJA/Xco/f05la4udNT2g70s0Z/VqdiOtgL0+lp5C/xadrlIkXp+ukZfkziQdYCMpEtNsOUgwdv/Q7Sy9eWHIXXBtju7fMrqH3WRPCkAfsb0B5P1SkJTIWYVYhWQGKta1mWydWsFqnI1HdDmla+rNMEinIcF8e+jHH9XzMzlpgSvt+J07MjLj1z7UsI0xx8m3U9mtepxXIBcWZ5TqdZlu/rNMfyA53mWZ7X6QhLW6ejLD/UaYHlRzodY3lBC5p038GQizDkAg6QMISlA0NYXoIhLBUMYbkIQ1gWYQjLJRjC8mMYwnIZhrC8rGXV1FNJ49qZWAZsQmBijh65zEXlaiq5VEK7aFRqQ54SbpVUFM+qf2WgXjzyhjmwFkiXyJpfMc6Vj0bl+NYVLW8aO1fAsepvH472OfFS1ouFPwX/1dZUJb1izcOTq/Abhp5sJ6o2qXh0TZfPVT26/l9UVFgL9BtIhVgoyrJscGcihI86nYZqoJVDzGzMPLTrdcuan8P9NzFCFlD9+DcUGgvcg05ZSVnt4KzV19uy3DuDcjgTLEkxN/P6VvgiI7PSfpFZyp6PfB5wBYxKZdhqA60VvNknMQ+Z3iTPBHFbUTZI2tjOBIkNHPOAefOdBCZh6qoN5E7hhg34BWFuwXknXKJ6oyyH7kXs8yik/Fun4kT2qGiMwLPZG2Gv70LKb3EMJDT5pX4MVBWhqRg1FdA0Um6oBl/G2bptQsYO9CMqdsOyrOLDxxb3lZJtGYR8pIjVo6Of1l6iTqrcfmYUl++dvgXBIDUxf3vfdHGQyrtayTJHbQNTtxqVU9eaQ+NVh+rmUfW94+wTOWuabronHnpf06rbwcVcLLD2bQ7SUiYX1PVhhQ2iy8WlUOplNEnvuAcYFhjQ71CKjf+r+th8nitVhdFxJN9O1LfR52AM/A/Yf0f1A9D3Y+hyDS7P95oTn2704WyZrqIX66foNzBrrblZugbc0HQD4iFHrY64yg18pwZxeqS5HOkh4GPdFeIBwCaAxeAT3bWM5lMAo/mMOT7A58xh0GQOgy3mMNhmzhrADnMY7DKHwR5zGHzBnHWAL5nDIGQOg4g5DJ4wJwB4yhwGXzGHwdfMYfANc+4DfMscBjFzGCTMYbCv6dYwzC1e0F2gtkFVoANTT1jcw+JQU2XI/o4Xhv29Qcz+wSCm/qjp9pD6Ey8M9WeDmPqLQUz9VdOdIfU3Xhjq7wYx9Q+DmPpMvxjLZQa/jHyXCgeUXWw+5++J9w/bxUC5AAEAAf//AA94nIVVX2hbZRQ/5/t7893s5ja9f7ouzdZ0TTqz3bRJmogbWya6bG6Cq0VbSV2ddIJjFtfIQHEig80Hda8yUN/0YQz8AyriiyD+xQd92R4HCnaCb3samnpumrpsCsLlfPf7zvedc37nL3CAtc/5W/wQZGA3tOBSY/g+TMjHmwzEoM1Q8+ZjRZY4oJhmBw5/YB6Za0yC5AkhlwA1A1yCBIBOwCII0Cj0U8BAMdUCzq05sKwkP7SlUY6fcJk4Fb/RyE79/6P5hjM/F4aZiXBoeMgzcqQ4Xi1hPqfDLG5FT+lchCVU3lYMyvuwhl1mqndQL0RsuloLywHtthLXI06OblTrhfWVnpSJ5+mwu/JdbtuN3IAnkW0LLMcRwaC7ktrlzridM6kVdyf9uO1UNBByI7JhwtG2sEwab07ORBeilWhqavJCqV0qzZTOl/7ZXQ5TbTcdcFelyGhhRDAQpdqp1FEX3w3cFTc1k9pJQkmm4ySCbSikxRP2QOfN+0tHS5MrpQuTU1Mk5nw0E5Xa0WvrOwDyGax9yB9ma6DAg82wHc43SAGTI4GjBWebOePAERFE8/AHaQpZASSTy8A4WwZiLQMQ82mFKATO0ILicRAoDm9p5P99E5b/fXG+kQYY3TYUuqmERWYoT0u/GNYL2q/4WB3LaVS+VynXsVYIcWw6DkCh3nX1D+VzlYN4LClF5yexSQos8exqZ3KVP+wtrC54u4Nznq6cq+xpMpUUnZ8FUYzE86ud0g28NOIv3Gj5/rmA3ABs7S/ywzFuQ4qyd6QxfNtiQIaEgp3w/entQg4Vcbqa16M5FfpeUB8t1+qeg7mI7cUyOe79wOk86gSxkVec4KPTX69++5x68Yubn5/F+w52z7u08sJX7fZXv8ekT/d2mILJxq6sn+SC6qEJknzLJCxyZEKwWVqYmAPBxBE/9DLeZiWHu7lcr/VytrCRuHojncNuTt9h46tmacmYisnSamdN2bZptcsmSysdVsy1PrOvOzF3xN64Rb937t/og9KHxYdcjIUqFAmIAHGHNzlns+RTPgeUYAQm9DwpNxfxbhhBHPaw3/gfTcXO2L+eJVIx5nsyGkvm9X4/f+bGkH45G0PaSjcMXTjcZyTvi3UdHoCDjQd3IDUVsgwYmUoJK/gp4JJxeRI0MKHZIkgynyIBqBTOUs6rOVCojvjZ4mCQz49ZMlMcp8QoYk6NoBfsxnJtsBohpa8iGJS+ZH7gU7NxME6cmF+t7cO9vB8d3jTWSct0ycW9ranXmolNDwmVkNnxe+8JtoztwS5rKJ0xWS95tQ/1zMYzg69MzUZnNtl1ofNbsml/OJm6f9wjRjpnu2o4MzHzn77IQkRd+1DjwMQ2pqSjGMMhyjrgTbBAKksuUm0iU7hI0aN2wOKOq7WYBSH0HGihj/jkiPxAfmwsEbfYrjMG+j3ij932Db/LV7I/xruNrhnroxjR9HRMb2nTvO0ZXOoHPk8H2ZhDPx93qcE/53sH5np/dkIP7zzhTVKdR/BAY/9ElkkR+A6lJGsqpJ4oQcTxpvBT3Kn58VkaJjgHyPEIws57xkaHh9KuVpDEpJZeMbZ5w/zBHi5NMQ4r5VphsFqID7TyB9eR4pX216c3AHxpdAwoqU9qg0ZJ6yVLKmMSz1iG2z27ifx18NkY0LPx1W/wCc2l5LrznrIsiKsqbmB78A9wIGx4tI8rjihVHJyY9pgMirenVq0yWg7Iw7eogG7ZgYM3qR9959A/fZkg6MnD/exlkmc+jWV4SB15XUR+eqC6l6ZmgPtN9z5JMfik05OV8ljylunJ4J+wA/FUaQSSKotsYsCWqaPBidBLcxkWx7XKFRIb45TGaEhjlF9uUVPqXOtcIwsXbBvfoZXIyRYFdkfnqjExH98xpnPczqzjX/uNdO1Y17Wpi5+6Ts8BXtjVFasp9KZ1mOiNbH65c5w6HgmyF2jFCZywM8mWjRc7T5Pmt0lRy7Y71+jYbpGyvwG4sH0XeJxjYGRgYADiwBB/53h+m68M3MwvgCIM1z5N/g6j///9v5H5BbMnkMvBwAQSBQCIcA9gAHicY2BkYGAO+p8FJF/8//v/F/MLBqAICuAFALYQB5kAeJxjfsHAwLwAiCNB+P9fbJjJmoGBMRUo/wKCAfO2EnQAAAAAANoBXgGcAgICVALaA1IDvAPkBAYEPARyAAEAAAANAF0ABAAAAAAAAgAUACQAcwAAAG4LcAAAAAB4nHWRzWrCQBSFT+pPqUIXLXTTzayKUohGKIibCoLuhbrrYtTRxCYZmYyKyz5Fd32HvlDfoO/QkziIFJtw9bvnnpl7ZwLgBt/wcHieGAf2UGd24Atcou+4RH3kuEweO66QXx1XyaHjGh6ROa7jFp/cwStfMVvhy7GHO+/e8QWuvcBxifqz4zL5xXGF/Oa4Sn53XMPE+3Bcx4P3M9DrvYmWoRWNQVN02kFXTPdCU4pSGQu5saE2meiLhU6timPtz3SSs9ypTCdqrJabWJoT5QQnymSRTkXgt0/UkUqVkVbN807ZdtmxdiEWRidi6HqItdErNbN+aO2612qd9sYAGmvsYRBhyUu0EGhQbfK/gzYCdElTOgSdB1eEFBIxFYkNV4RFJWPeZyyYpVQVHTHZx4y/yVGX2LGWFZri51TccUOn5B7nPefVCSPvGhVVwUl9znveO2KkhV8Wk82PZ8qwZf8OVcu1+fSmWCMw/HMOwXvKaysqM+p+cVuWag8tvv+c+xdd+4+teJxtjUEOwiAURJla24KliQfhUA2g/Sl+CKXx+loNrpzVezOLEY34Ron/0WhwQoszOvQYIKFwwQiNSbSBeO2SZ0tBP4j3zVjKNng32ZmtD1VVXCuOiw/pJ8S3WOU6l+K5UOTaDC4+2TjKMtN9KQf1ezLx/Sg/00FCvABHhjDjAAB4nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjEwMmiBGJu5mBg5ICw+BjCLzWkX0wGgNCeQze60i8EBwmZmcNmowtgRGLHBoSNiI3OKy0Y1EG8XRwMDI4tDR3JIBEhJJBBs5mFi5NHawfi/dQNL70YmBhcADHYj9AAA) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><title>readme</title></head><body><article class="markdown-body"><h2 id="1">1.项目分析<a class="headerlink" href="#1" title="Permanent link"></a></h2>
<p>开发之前，对项目进行分析。
发现需要处理的数据类型有：
- 商品
- 商品类别
- 收藏
- 订单
- 购物车
- 用户
- 收货地址。</p>
<p>然后确定开发顺序，遵循的原则是由简到难。
用户&gt;收货地址&gt;修改资料&gt;注册&gt;登录。</p>
<p>先开发基础功能：修改密码&gt;修改资料&gt;上传头像。并且遵循“增查删改”的顺序。</p>
<p>数据表&ndash;&gt;实体类&ndash;&gt;业务&ndash;&gt;控制器&ndash;&gt;页面。</p>
<h2 id="2">2. 创建用户数据表<a class="headerlink" href="#2" title="Permanent link"></a></h2>
<p>创建数据库和用户表：
<div class="codehilite"><pre><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">tedu_store</span><span class="p">;</span>
<span class="k">USE</span> <span class="n">tedu_store</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">t_user</span> <span class="p">(</span>
    <span class="n">uid</span> <span class="kt">INT</span> <span class="kp">AUTO_INCREMENT</span> <span class="n">COMMENT</span> <span class="s1">&#39;用户id&#39;</span><span class="p">,</span>
    <span class="n">username</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">UNIQUE</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="n">COMMENT</span> <span class="s1">&#39;用户名&#39;</span><span class="p">,</span>
    <span class="n">password</span> <span class="kt">CHAR</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="n">COMMENT</span> <span class="s1">&#39;密码&#39;</span><span class="p">,</span>
    <span class="n">salt</span> <span class="kt">CHAR</span><span class="p">(</span><span class="mi">36</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;盐值&#39;</span><span class="p">,</span>
    <span class="n">phone</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;手机号码&#39;</span><span class="p">,</span>
    <span class="n">email</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;电子邮箱&#39;</span><span class="p">,</span>
    <span class="n">gender</span> <span class="kt">INT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;性别：0-女，1-男&#39;</span><span class="p">,</span>
    <span class="n">avatar</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;头像&#39;</span><span class="p">,</span>
    <span class="n">is_delete</span> <span class="kt">INT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;是否标记为删除：0-未删除，1-已删除&#39;</span><span class="p">,</span>
    <span class="n">created_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;创建人&#39;</span><span class="p">,</span>
    <span class="n">created_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
    <span class="n">modified_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;最后修改人&#39;</span><span class="p">,</span>
    <span class="n">modified_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s1">&#39;最后修改时间&#39;</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">uid</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="kp">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</pre></div></p>
<blockquote>
<p>UTF-8编码在MySQL中有utf8mb3(most byte 3)和utf8mb4(most byte 4)这2种，如果在SQL语句中直接使用utf8，则表示utf8mb3.
推荐使用v5.5以上版本的MySQL。  </p>
</blockquote>
<h2 id="3">3. 创建用户实体类<a class="headerlink" href="#3" title="Permanent link"></a></h2>
<ul>
<li>先创建一个<code>BaseEntiy</code>类，作为实体类的基类。基类中有四个属性。然后还实现了<code>Serializable</code>接口，便于Spring框架通过反射技术实例化这个类的实例对象。
<div class="codehilite"><pre><span class="kn">package</span> <span class="nn">cn.tedu.store.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">BaseEntity</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">3122958702938259476L</span><span class="o">;</span>


    <span class="kd">private</span> <span class="n">String</span> <span class="n">createdUser</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">createdTime</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">modifiedUser</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Date</span> <span class="n">modifiedTime</span><span class="o">;</span>

    <span class="c1">// Setters and Getters</span>

    <span class="c1">// toString()</span>

<span class="o">}</span>
</pre></div>
然后创建一个<code>User</code>类</li>
</ul>
<h2 id="4-">4. 用户-注册-持久层<a class="headerlink" href="#4-" title="Permanent link"></a></h2>
<p>application.properties添加配置：
<div class="codehilite"><pre>server.port=8080

spring.datasource.url=jdbc:mysql://localhost:3306/tedu_store?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimeZone=Asia/Shanghai
spring.datasource.driver=com.mysql.cj.jdbc.Driver
spring.datasource.username=root
spring.datasource.password=uiop7890

mybatis.mapper-locations=classpath:mappers/*.xml
</pre></div></p>
<h1 id="java">java单元测试：注意不要导错包<a class="headerlink" href="#java" title="Permanent link"></a></h1>
<p>是<code>org.junit.Test</code>， 而不是<code>org.junit.jupiter.api.Test;</code>。另外，测试方法要用<code>public</code>修饰。</p>
<h2 id="5">5. 用户注册业务的实现<a class="headerlink" href="#5" title="Permanent link"></a></h2>
<ul>
<li>
<p>实现原理和步骤：</p>
</li>
<li>
<p>关于用户密码的加密：</p>
</li>
</ul>
<h4 id="commons-codecapi"><code>commons-codec</code>提供了更多消息摘要算法的API。<a class="headerlink" href="#commons-codecapi" title="Permanent link"></a></h4>
<p>添加依赖:</p>
<p><div class="codehilite"><pre><span class="nt">&lt;dependency&gt;</span>
    <span class="nt">&lt;groupId&gt;</span>commons-codec<span class="nt">&lt;/groupId&gt;</span>
    <span class="nt">&lt;artifactId&gt;</span>commons-codec<span class="nt">&lt;/artifactId&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
调用DigestUtils提供的摘要算法。
<div class="codehilite"><pre><span class="kn">import</span> <span class="nn">org.apache.commons.codec.digest.DigestUtils</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">StoreApplicationTests</span> <span class="o">{</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">sha1HaxTest</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">&quot;123456&quot;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">md5Password</span> <span class="o">=</span> <span class="n">DigestUtils</span><span class="o">.</span><span class="na">sha1Hex</span><span class="o">(</span><span class="n">password</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="n">System</span><span class="o">.</span><span class="na">err</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">md5Password</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
控制台输出：<code>7c4a8d09ca3762af61e59520943dc26494f8941b</code>.</p>
<p>注册和登录都需要对密码进行加密。所以单独的创建一个<code>public String getMd5Password(String password, String salt)</code>方法。</p>
<h3 id="spring">Spring来统一处理异常<a class="headerlink" href="#spring" title="Permanent link"></a></h3>
<p>同样的异常可能会在多个业务中出现，且对应的处理方式是相同的。</p>
<p>SpringMVC提供了统一处理异常的机制。</p>
<p>具体做法：
+ 先定义一个统一处理异常的方法
    - 用<code>@ExceptionHandler</code>注解，标记这是一个异常处理的方法。
    - 应该使用<code>public</code>权限
    - 必须包含一个<code>Exception</code>类型的参数，以供框架捕获使用。
    - 
<div class="codehilite"><pre><span class="nd">@ExceptionHandler</span>
<span class="kd">public</span> <span class="n">JsonResult</span><span class="o">&lt;</span><span class="n">Void</span><span class="o">&gt;</span> <span class="nf">aaa</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div></p>
<h4 id="_1">上传头像<a class="headerlink" href="#_1" title="Permanent link"></a></h4>
<ol start="2">
<li>规划异常: 不需要，因为操作很简单，几乎不会出错啊</li>
<li><code>UserService</code>中添加抽象方法</li>
<li><code>UserServiceImpl</code>中实现抽象方法
<div class="codehilite"><pre><span class="o">/**</span>
 <span class="n">uid</span><span class="o">,</span> <span class="n">username</span><span class="o">,</span> <span class="n">用户ID和用户名</span><span class="err">；</span><span class="n">String</span> <span class="n">avatar</span> <span class="n">是路径</span><span class="err">。</span>
</pre></div></li>
</ol>
<h2 id="272">27.2 在控制器中处理文件上传<a class="headerlink" href="#272" title="Permanent link"></a></h2>
<p>在处理请求的方法中，添加<code>MultipartFile</code>接口的参数。</p>
<p>这里的<code>MultipartFile</code>既封装了用户上传的文件，又封装了文件的一些信息，比如<code>file.getOrigalFileName()</code>。</p>
<h2 id="273-multipartfileapi">27.3 <code>MultipartFile</code>接口提供的API<a class="headerlink" href="#273-multipartfileapi" title="Permanent link"></a></h2>
<ul>
<li><code>String getOriginalFileName()</code>:获取文件的原始文件名。</li>
<li><code>boolean isEmpty()</code>:上传表单中未选择文件就提交，或选择的文件大小为0</li>
<li><code>long getSize()</code>: 获取上传的文件的大小，以字节为单位。</li>
<li><code>InputStream getInputStream()</code>: 获取输入流。</li>
<li><code>String getContentType</code>: 获取文件MIME类型</li>
<li><code>void transferTo(File dest)</code>:将客户端上传的文件数据保存到服务器的某个文件中。</li>
</ul>
<h2 id="274">27.4 修改上传文件下载的限制<a class="headerlink" href="#274" title="Permanent link"></a></h2>
<p>SpringBoot框架，限制了文件上传大小。
有两种解决方案：</p>
<h3 id="configure">在包含<code>@Configure</code>注解的类中配置<a class="headerlink" href="#configure" title="Permanent link"></a></h3>
<ol>
<li>
<p>在启动类中，更改上传文件的大小限制
<div class="codehilite"><pre>    <span class="c1">// 定义全局的上传文件大小限制</span>
    <span class="cm">/**</span>
<span class="cm">     * 获取MultipartConfigElement</span>
<span class="cm">     */</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="n">MultipartConfigElement</span> <span class="nf">getMultipartConfigElement</span><span class="o">()</span> <span class="o">{</span>
        <span class="c1">// 当前项目中 无论上传的是什么 都不允许超过100M， 若超过，则控制器不会执行。</span>
        <span class="n">MultipartConfigFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultipartConfigFactory</span><span class="o">();</span>
        <span class="n">DataSize</span> <span class="n">dataSize</span> <span class="o">=</span> <span class="n">DataSize</span><span class="o">.</span><span class="na">ofMegabytes</span><span class="o">(</span><span class="mi">100</span><span class="o">);</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setMaxFileSize</span><span class="o">(</span><span class="n">dataSize</span><span class="o">);</span>
        <span class="n">factory</span><span class="o">.</span><span class="na">setMaxRequestSize</span><span class="o">(</span><span class="n">dataSize</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">factory</span><span class="o">.</span><span class="na">createMultipartConfig</span><span class="o">();</span>
    <span class="o">}</span>
</pre></div>
主要使用到启动类的<code>@Configuration</code>注解，你自己写个类添加<code>@Configuration</code>注解，然后在自己写的类中添上面代码，也可以。</p>
</li>
<li>
<p>在__application.properties__中添加配置信息：
根据SpringBoot版本添加不同的信息：
SpringBoot v1.4之前
<div class="codehilite"><pre>multipart.maxFileSize=10MB          // 单个文件大小不得超过10MB
multipart.maxRequestSize=100MB      // 单次请求文件不得超过100MB
</pre></div>
SpringBoot v1.4之后
<div class="codehilite"><pre>spring.http.multipart.maxFileSize=10MB
spring.http.multipart.maxReqeustSize=100MB
</pre></div>
SpringBoot v2.0之后
<div class="codehilite"><pre>spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=100MB
</pre></div></p>
</li>
</ol>
<h2 id="275">27.5 一次上传多个文件<a class="headerlink" href="#275" title="Permanent link"></a></h2>
<h3 id="_2">上传数量固定的文件<a class="headerlink" href="#_2" title="Permanent link"></a></h3>
<p><div class="codehilite"><pre><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    请选择身份证的正面照片：<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;file1&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
    请选择身份证的反面照片：<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;file2&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
上传数量固定的文件时，控制器中，处理请求的方法中使用两个参数来表示两个不同的文件即可：
<div class="codehilite"><pre><span class="kd">public</span> <span class="n">JsonResult</span><span class="o">&lt;?&gt;</span> <span class="n">upload</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">file1</span><span class="o">,</span> <span class="n">MultipartFile</span> <span class="n">file2</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 处理第一个文件</span>
    <span class="c1">// 处理第二个文件</span>
<span class="o">}</span>
</pre></div></p>
<h3 id="_3">上传数量不固定的文件<a class="headerlink" href="#_3" title="Permanent link"></a></h3>
<p>如果上传文件的数量在一定范围内不可控，例如微信朋友圈最多9张，但是你上传一张也可以。
再比如说，网购之后的买家秀，也是不定数量的图片。</p>
<p>针对这种情况，可以采取的做法，有</p>
<ul>
<li>
<p>使用多个同名的上传控件。
<div class="codehilite"><pre><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">action=</span><span class="s">&quot;&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>
    请选择身份证的正面照片：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;p&gt;</span>
    请选择身份证的反面照片：<span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;file&quot;</span> <span class="na">name=</span><span class="s">&quot;file&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></div>
一场代码中，使用的多个上传控件的<code>name</code>是相同的！在前端页面中，还可以使用JS技术动态添加更多的控件。</p>
</li>
<li>
<p>直接在上传控件上添加<code>multiple="multiple"</code>属性
<div class="codehilite"><pre><span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">enctype</span><span class="o">=</span><span class="s">&quot;multipart/form-data&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>请选择上传的图片：
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;file&quot;</span> <span class="na">mutliple</span><span class="o">=</span><span class="s">&quot;multiple&quot;</span><span class="p">/&gt;</span>
    <span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
就可以一次上传多个文件。</p>
</li>
</ul>
<p>在控制器处理请求的方法中，上传文件的参数对象应该声明为数组格式。例如：
<div class="codehilite"><pre><span class="kd">public</span> <span class="n">JsonResult</span><span class="o">&lt;?&gt;</span> <span class="n">upload</span><span class="o">(</span><span class="n">MultipartFile</span><span class="o">[]</span> <span class="n">files</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 遍历files, 处理每一个file</span>


<span class="o">}</span>
</pre></div></p>
<h2 id="276-ajax">27.6 在前端页面使用<code>$.ajax()</code>函数实现异步上传<a class="headerlink" href="#276-ajax" title="Permanent link"></a></h2>
<p>使用<code>$.ajax()</code>函数实现__上传文件__功能时，需要注意：
- <code>data</code>属性，必须是<code>new FromData(表单)</code>;
- 另外添加两个属性<code>"contentType":false</code>和<code>"processData":false</code>.</p>
<blockquote>
<p>$().click(); &gt; 遍历整个数组，为数组中的每一个标签都绑定单击事件的响应函数。</p>
</blockquote>
<p><div class="codehilite"><pre><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;text/javascript&quot;</span><span class="p">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#btn-change-avatar&quot;</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
            <span class="s2">&quot;url&quot;</span><span class="o">:</span><span class="s2">&quot;/users/avatar/change&quot;</span><span class="p">,</span>
            <span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="k">new</span> <span class="nx">FormData</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#form-upload&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
            <span class="c1">//......</span>
         <span class="p">})</span>
    <span class="p">})</span>
 <span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
其中<code>$("#form-upload")</code>得到的结果是一个元素为<code>Form</code>的数组，通过<code>[0]</code>来访问数组当中的第一个元素。</p>
<h1 id="28">28. 创建收货地址数据表<a class="headerlink" href="#28" title="Permanent link"></a></h1>
<div class="codehilite"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">t_address</span> <span class="p">(</span>
    <span class="n">aid</span> <span class="kt">INT</span>     <span class="kp">AUTO_INCREMENT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">COMMENT</span> <span class="s2">&quot;收货地址id&quot;</span><span class="p">,</span>
    <span class="n">uid</span> <span class="kt">INT</span>     <span class="n">COMMENT</span> <span class="s2">&quot;归属用户的id&quot;</span><span class="p">,</span>
    <span class="n">name</span>    <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>      <span class="n">COMMENT</span> <span class="s2">&quot;收货人姓名&quot;</span><span class="p">,</span>
    <span class="n">province_name</span>   <span class="kt">CHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>      <span class="n">COMMENT</span> <span class="s2">&quot;省&quot;</span><span class="p">,</span>
    <span class="n">province_code</span>   <span class="kt">CHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;省代号&quot;</span><span class="p">,</span>
    <span class="n">city_name</span>   <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;市&quot;</span><span class="p">,</span>
    <span class="n">city_code</span>   <span class="kt">CHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;市代号&quot;</span><span class="p">,</span>
    <span class="n">area_name</span>   <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;区&quot;</span><span class="p">,</span>
    <span class="n">area_code</span>   <span class="kt">CHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;区代号&quot;</span><span class="p">,</span>
    <span class="n">zip</span> <span class="kt">CHAR</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;邮政编码&quot;</span><span class="p">,</span>
    <span class="n">address</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;详细地址&quot;</span><span class="p">,</span>
    <span class="n">phone</span>   <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;电话&quot;</span><span class="p">,</span>
    <span class="n">tel</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;固话&quot;</span><span class="p">,</span>
    <span class="n">tag</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;地址类型&quot;</span><span class="p">,</span>
    <span class="n">is_default</span>  <span class="kt">INT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>      <span class="n">COMMENT</span> <span class="s2">&quot;是否默认：0-非默认， 1-默认&quot;</span><span class="p">,</span>
    <span class="n">created_user</span>    <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;创建人&quot;</span><span class="p">,</span>
    <span class="n">created_time</span>    <span class="kt">DATETIME</span>        <span class="n">COMMENT</span> <span class="s2">&quot;创建时间&quot;</span><span class="p">,</span>
    <span class="n">modified_user</span>   <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>     <span class="n">COMMENT</span> <span class="s2">&quot;最后修改人&quot;</span><span class="p">,</span>
    <span class="n">modified_time</span>   <span class="kt">DATETIME</span>        <span class="n">COMMENT</span> <span class="s2">&quot;最后修改时间&quot;</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="kp">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</pre></div>

<h1 id="29">29. 创建收货地址实体类<a class="headerlink" href="#29" title="Permanent link"></a></h1>
<p><div class="codehilite"><pre><span class="kn">package</span> <span class="nn">cn.tedu.store.entity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Address</span> <span class="kd">extends</span> <span class="n">BaseEntity</span> <span class="o">{</span>
    <span class="cm">/**</span>
<span class="cm">     * Generated Serial id</span>
<span class="cm">     */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="mi">3807707125821455168L</span><span class="o">;</span>
    <span class="c1">// Properties</span>

    <span class="c1">// Getters and Setters</span>

    <span class="c1">// toString()</span>

<span class="o">}</span>
</pre></div>
3. 持久层-插入数据
先创建个<code>AddressMapper</code>的接口，然后创装一个<code>AddressMapper.xml</code>的配置文件，
最后创建一个<code>AdressMapperTest</code>的测试类。
<div class="codehilite"><pre><span class="kn">package</span> <span class="nn">cn.tedu.store.mapper</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">AddressMapper</span> <span class="o">{</span>

<span class="o">}</span>
</pre></div>
<div class="codehilite"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span>  
<span class="cp">&lt;!DOCTYPE mapper PUBLIC &quot;-//ibatis.apache.org//DTD Mapper 3.0//EN&quot; </span>
<span class="cp">    &quot;http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd&quot;&gt;</span>

<span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;cn.tedu.store.mapper.AddressMapper&quot;</span><span class="nt">&gt;</span>

<span class="nt">&lt;/mapper&gt;</span>
</pre></div>
并在<code>AddressMapperTests</code>中引用一个<code>AddressMapper</code>实现类的实例对象
<div class="codehilite"><pre><span class="kn">package</span> <span class="nn">cn.tedu.store</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.junit.runner.RunWith</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.beans.factory.annotation.Autowired</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.boot.test.context.SpringBootTest</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.springframework.test.context.junit4.SpringRunner</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">cn.tedu.store.mapper.AddressMapper</span><span class="o">;</span>

<span class="nd">@RunWith</span><span class="o">(</span><span class="n">SpringRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AddressMapperTests</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">AddressMapper</span> <span class="n">mapper</span><span class="o">;</span>

<span class="o">}</span>
</pre></div>
开始实现插入数据的功能：
<code>UserMapper</code>接口中简单声明一个方法：
<div class="codehilite"><pre>
</pre></div>
__UserMapper.xml__配置文件中写好SQL语句:
<div class="codehilite"><pre>    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;addNew&quot;</span> <span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span> <span class="na">keyProperty=</span><span class="s">&quot;uid&quot;</span><span class="nt">&gt;</span>
        INSERT
        INTO t_address(
        aid,
        uid,
        name,
        province_name,
        province_code,
        city_name,
        city_code,
        area_name,
        area_code,
        zip CHAR(6),
        address,
        phone,
        tel,
        tag,
        is_default,
        created_user,
        created_time,
        modified_user,
        modified_time
        )
        VALUES
        (
        #{aid},
        #{uid},
        #{name},
        #{province_name},
        #{province_code},
        #{city_name},
        #{city_code},
        #{area_name},
        #{area_code},
        #{zip},
        #{address},
        #{phone},
        #{tel},
        #{tag},
        #{is_default},
        #{created_user},
        #{created_time},
        #{modified_user},
        #{modified_time}
        )
    <span class="nt">&lt;/insert&gt;</span>
</pre></div></p>
<ol start="4">
<li>持久层-根据uid删除收货地址</li>
</ol>
<h1 id="32-">32. 收货地址-业务层<a class="headerlink" href="#32-" title="Permanent link"></a></h1>
<ol>
<li>规划并创建异常。</li>
</ol>
<h1 id="35">35. 导入省市区数据表<a class="headerlink" href="#35" title="Permanent link"></a></h1>
<p><div class="codehilite"><pre><span class="n">mysql</span><span class="o">&gt;</span> <span class="n">source</span> <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">yuyu</span><span class="o">/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">PROJECT_DAY07_ALL_1750</span><span class="o">/</span><span class="n">t_dict_district</span><span class="p">.</span><span class="k">sql</span> 
<span class="n">mysql</span><span class="o">&gt;</span> <span class="k">show</span> <span class="kp">tables</span><span class="p">;</span>
<span class="o">+----------------------+</span>
<span class="o">|</span> <span class="n">Tables_in_tedu_store</span> <span class="o">|</span>
<span class="o">+----------------------+</span>
<span class="o">|</span> <span class="n">t_address</span>            <span class="o">|</span>
<span class="o">|</span> <span class="n">t_dict_district</span>      <span class="o">|</span>
<span class="o">|</span> <span class="n">t_user</span>               <span class="o">|</span>
<span class="o">+----------------------+</span>
<span class="mi">3</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</pre></div>
dict:字典
district:地区</p>
<h1 id="36-">36. 省市区-创建实体类<a class="headerlink" href="#36-" title="Permanent link"></a></h1>
<p>创建<code>cn.tedu.store.entity.District</code>地区实体类。
<div class="codehilite"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">District</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
    <span class="c1">// Serial Version UID</span>
    <span class="c1">// Properties</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">id</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">parent</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">code</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="c1">// Getters and Setters </span>
    <span class="c1">// 基于id的hashCode()与equals()</span>
    <span class="c1">// toString</span>
<span class="o">}</span>
</pre></div></p>
<h1 id="36-_1">36. 省市区-显示列表-持久层<a class="headerlink" href="#36-_1" title="Permanent link"></a></h1>
<ol>
<li>分析规划需要执行的SQL语句
获取全国所有省/某省所有市/某市所有区的列表，需要执行的SQL语句大致是：
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_dict_district</span> <span class="k">WHERE</span> <span class="n">parent</span><span class="o">=?</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">code</span> <span class="k">ASC</span><span class="p">;</span>
</pre></div></li>
</ol>
<h1 id="37-">37. 省市区-显示列表-业务层<a class="headerlink" href="#37-" title="Permanent link"></a></h1>
<ol start="2">
<li>
<p>接口与抽象方法
<div class="codehilite"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">DistrictService</span> <span class="o">{</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">District</span><span class="o">&gt;</span> <span class="nf">getByParent</span><span class="o">(</span><span class="n">String</span> <span class="n">parent</span><span class="o">);</span>
<span class="o">}</span>
</pre></div></p>
</li>
<li>
<p>创建<code>DistrictServiceImpl</code>作为<code>DistrictService</code>的实现类。添加<code>@Service</code>注解，并在类中添加<code>@Autowired private DistrictMapper districtMapper;</code>持久层对象。
<div class="codehilite"><pre><span class="kn">package</span> <span class="nn">cn.tedu.store.service.impl</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DistrictServiceImpl</span> <span class="kd">implements</span> <span class="n">DistrictService</span> <span class="o">{</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">District</span><span class="o">&gt;</span> <span class="nf">getByParent</span><span class="o">(</span><span class="n">String</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">// TODO Auto-generated method stub</span>
        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></div>
然后开始写业务：</p>
</li>
</ol>
<h1 id="38-">38. 省市区-显示列表-控制器层<a class="headerlink" href="#38-" title="Permanent link"></a></h1>
<ol>
<li>处理异常： 无</li>
<li>设计需要处理的请求
- 请求路径：<code>/districts/</code>
- 请求参数：<code>String parent</code>
- 使用Session：否
- 请求类型：<code>GET</code>
- 相应数据：<code>JsonResult&lt;List&lt;Distirct&gt;&gt;</code>
- 是否拦截：<code>否</code></li>
<li>处理请求
- 在拦截器的配置类<code>InterceptorConfigration</code>中，将<code>/districts/**</code>添加到白名单。
<div class="codehilite"><pre><span class="n">patterns</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">&quot;/districts/**&quot;</span><span class="o">);</span>
<span class="n">registy</span><span class="o">.</span><span class="na">addInterceptor</span><span class="o">(</span><span class="n">interceptor</span><span class="o">).</span><span class="na">addPathPatterns</span><span class="o">(</span><span class="s">&quot;/**&quot;</span><span class="o">).</span><span class="na">excludePathPatterns</span><span class="o">(</span><span class="n">patterns</span><span class="o">);</span>
</pre></div>
- 创建<code>DistrictController</code>继承自<code>BaseController</code>，在类的声明之前添加<code>@RestController</code>和<code>@RequestMapping("districts")</code>注解。并添加业务层对象<code>@Autowired private AddressService addressService</code>。
<div class="codehilite"><pre><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">&quot;district&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">DistrictController</span> <span class="kd">extends</span> <span class="n">BaseController</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="kd">private</span> <span class="n">DistrictService</span> <span class="n">districtService</span><span class="o">;</span>

    <span class="nd">@GetMapping</span>
    <span class="kd">public</span> <span class="n">JsonResult</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">District</span><span class="o">&gt;&gt;</span> <span class="nf">getByParent</span><span class="o">(</span><span class="n">String</span> <span class="n">parent</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">District</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">districtService</span><span class="o">.</span><span class="na">getByParent</span><span class="o">(</span><span class="n">parent</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span><span class="o">&lt;&gt;(</span><span class="n">SUCCESS</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div></li>
</ol>
<h1 id="chrome-command-option-j-command-option-c">Chrome快捷键 command option + J 控制台 command option + C 选择器<a class="headerlink" href="#chrome-command-option-j-command-option-c" title="Permanent link"></a></h1>
<h1 id="44-">44. 收货地址 - 显示列表 - 持久层<a class="headerlink" href="#44-" title="Permanent link"></a></h1>
<ol>
<li>分析要执行的SQL语句
显示收货地址列表，需要执行的SQL语句大致是:
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_address</span> <span class="k">WHERE</span> <span class="n">uid</span> <span class="o">=</span> <span class="o">?</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">is_default</span> <span class="k">DESC</span> <span class="n">modifiedTime</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div></li>
<li>接口与抽象方法
在<code>AddressMapper</code>接口中添加抽象方法：
<div class="codehilite"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="nf">findByUid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">);</span>
</pre></div></li>
<li>
<p>配置映射
在__AddressMapper.xml__中，配置映射：
<div class="codehilite"><pre><span class="nt">&lt;resultMap</span> <span class="na">id=</span><span class="s">&quot;AddressEntityMap&quot;</span> <span class="na">type=</span><span class="s">&quot;cn.tedu.store.entity.Address&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;id</span> <span class="err">...</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;result</span> <span class="err">...</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/resultMap&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findByUid&quot;</span> <span class="na">resultMap=</span><span class="s">&quot;AddressEntityMap&quot;</span><span class="nt">&gt;</span>
    SELECT * FROM t_address WHERE uid = #{uid} ORDER BY is_default DESC modifiedTime DESC;
<span class="nt">&lt;/select&gt;</span>
</pre></div></p>
</li>
<li>
<p>实现抽象方法
在<code>AddressService</code>中，添加抽象方法：
<div class="codehilite"><pre><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="nf">getByUid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">);</span>
</pre></div>
在<code>AddressServiceImpl</code>中规划以上方法的实现：
<div class="codehilite"><pre><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Address</span><span class="o">&gt;</span> <span class="nf">getByUid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 基于uid调整持久层的findById()查询得到收货地址的列表数据</span>
    <span class="c1">// 遍历查询到的收货地址的数据</span>
    <span class="c1">// 将遍历到的对象不需要显示在页面上的属性设置为null</span>
    <span class="c1">// uid provinceCode cityCode areaCode is</span>
    <span class="c1">// 返回收货地址列表</span>
<span class="o">}</span>
</pre></div></p>
</li>
</ol>
<h1 id="_4">作业:<a class="headerlink" href="#_4" title="Permanent link"></a></h1>
<ol>
<li>将指定的收货地址设置为默认收货地址
需要执行的SQL语句大致是:
<div class="codehilite"><pre><span class="k">UPDATE</span> <span class="n">t_address</span> <span class="kt">SET</span> <span class="n">is_default</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">modified_user</span><span class="o">=?</span><span class="p">,</span> <span class="n">modified_time</span><span class="o">=?</span> <span class="k">WHERE</span> <span class="n">aid</span> <span class="o">=</span> <span class="o">?</span>
</pre></div>
抽象方法应该设计为：
<div class="codehilite"><pre><span class="n">Integer</span> <span class="nf">updateDefaultByAid</span> <span class="o">(</span>
    <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;aid&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">aid</span><span class="o">,</span>
    <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;modifiedUser&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">modifiedUser</span><span class="o">,</span>
    <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;modifiedTime&quot;</span><span class="o">)</span> <span class="n">Date</span> <span class="n">modifiedTime</span>
<span class="o">)</span>
</pre></div></li>
<li>将用户的默认收货地址取消掉
<div class="codehilite"><pre><span class="k">UPDATE</span> <span class="n">t_address</span> <span class="kt">SET</span> <span class="n">is_default</span><span class="o">=</span><span class="mi">0</span> <span class="k">WHERE</span> <span class="n">uid</span><span class="o">=?</span>
</pre></div>
抽象方法应该设计为：
<div class="codehilite"><pre><span class="n">Integer</span> <span class="nf">updateNoneDefaultByUid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">);</span>
</pre></div></li>
</ol>
<h3 id="2-1">先执行2 再执行1<a class="headerlink" href="#2-1" title="Permanent link"></a></h3>
<ol start="3">
<li>根据收货地址id查询收货地址详情
需要执行的SQL语句：
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_address</span> <span class="k">WHERE</span> <span class="n">uid</span><span class="o">=?</span>
</pre></div>
抽象方法应该设计为：
<div class="codehilite"><pre><span class="n">Address</span> <span class="nf">findByAid</span><span class="o">(</span><span class="n">Integer</span> <span class="n">aid</span><span class="o">);</span>
</pre></div></li>
<li>根据收货地址id删除收货地址数据
<div class="codehilite"><pre><span class="k">DELETE</span> <span class="k">FROM</span> <span class="n">t_address</span> <span class="k">WHERE</span> <span class="n">aid</span><span class="o">=?</span>
</pre></div></li>
<li>查询某用户最后修改的收货地址数据
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_address</span> <span class="k">WHERE</span> <span class="n">uid</span><span class="o">=?</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">modified_time</span> <span class="k">DESC</span> <span class="k">LIMIT</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
</pre></div></li>
<li>将t_products.sql脚本导入到数据库中</li>
<li>在项目中创建数据的实体类<code>Product</code></li>
<li>根据商品id查询商品数据详情</li>
</ol>
<h1 id="46-">46. 收货地址-业务层-设为默认地址功能实现<a class="headerlink" href="#46-" title="Permanent link"></a></h1>
<ol>
<li>
<p>规划业务流程，创建异常
- 先检查要设置的地址在数据库中是否存在，若地址不存在，则抛出<code>AddressNotFoundException</code>;
- 然后判断要设为默认的地址是否为当前登录用户的地址。如果不是，则抛出<code>AccessDeniedException</code>;
- 更新数据操作室，有可能会出错，抛出<code>UpdateException</code>这个异常类已经存在了，不用新创建。
+ 所以需要创建的异常类，有<code>AddressNotFoundException</code>和<code>AccessDeniedException</code>.</p>
</li>
<li>
<p>设计抽象方法
在<code>AddressService</code>中添加抽象方法:
<div class="codehilite"><pre>    <span class="cm">/**</span>
<span class="cm">    * 设置默认收货地址</span>
<span class="cm">    */</span>
    <span class="kt">void</span> <span class="nf">setDefualt</span><span class="o">(</span><span class="n">Integer</span> <span class="n">aid</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">,</span> <span class="n">String</span> <span class="n">username</span><span class="o">);</span>
</pre></div></p>
</li>
<li>实现抽象方法并测试
在<code>AddressServiceImpl</code>中实现<code>setDefault</code>方法。
<div class="codehilite"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDefault</span><span class="o">(</span><span class="n">Integer</span> <span class="n">aid</span><span class="o">,</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">,</span> <span class="n">String</span> <span class="n">username</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// 判断收货地址是否在数据库中存在</span>
    <span class="c1">// 判断是否为当前登录用户的收货地址</span>
    <span class="c1">// </span>
<span class="o">}</span>
</pre></div></li>
</ol>
<h1 id="64-">64. 购物车-创建数据表<a class="headerlink" href="#64-" title="Permanent link"></a></h1>
<div class="codehilite"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">t_cart</span> <span class="p">(</span>
    <span class="n">cid</span> <span class="kt">INT</span> <span class="kp">AUTO_INCREMENT</span> <span class="n">COMMENT</span><span class="s1">&#39;购物车数据id&#39;</span><span class="p">,</span>
    <span class="n">uid</span> <span class="kt">INT</span> <span class="n">COMMENT</span> <span class="s1">&#39;用户id&#39;</span><span class="p">,</span>
    <span class="n">pid</span> <span class="kt">INT</span> <span class="n">COMMENT</span> <span class="s1">&#39;商品id&#39;</span><span class="p">,</span>
    <span class="n">num</span> <span class="kt">INT</span> <span class="n">COMMENT</span> <span class="s1">&#39;商品数量&#39;</span><span class="p">,</span>
    <span class="n">price</span> <span class="kt">BIGINT</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;加入购物车时商品单价&#39;</span><span class="p">,</span>
    <span class="n">created_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;创建人&#39;</span><span class="p">,</span>
    <span class="n">created_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s1">&#39;创建时间&#39;</span><span class="p">,</span>
    <span class="n">modified_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s1">&#39;最后修改人&#39;</span><span class="p">,</span>
    <span class="n">modified_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s1">&#39;最后修改时间&#39;</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">cid</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="kp">CHARSET</span><span class="o">=</span><span class="n">utf8mb4</span><span class="p">;</span>
</pre></div>

<h1 id="65-">65. 购物车-创建实体类<a class="headerlink" href="#65-" title="Permanent link"></a></h1>
<p>在<code>cn.tedu.store.entity</code>包中创建<code>Cart</code>购物车实体类。
<div class="codehilite"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Cart</span> <span class="kd">extends</span> <span class="n">BaseEntity</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="kt">long</span> <span class="n">serialVersionUID</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9051846958681813039L</span><span class="o">;</span>
    <span class="kd">private</span>  <span class="n">Integer</span> <span class="n">cid</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">pid</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Integer</span> <span class="n">num</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">Long</span> <span class="n">price</span><span class="o">;</span>

    <span class="c1">// Getters and Getters / toString() / hashCode() equals()</span>
<span class="o">}</span>
</pre></div></p>
<h1 id="66-">66. 加入购物车-持久层<a class="headerlink" href="#66-" title="Permanent link"></a></h1>
<h2 id="1-sql">1. 分析需要执行的SQL语句<a class="headerlink" href="#1-sql" title="Permanent link"></a></h2>
<p>将商品添加到购物车，具体分为两种情况：一种情况是第一次将该商品添加到购物车，另一种情况是购物车中已经存在该商品，此时点击【添加到购物车】，表现的结果应当是，在购物车中增加购买数量。</p>
<h3 id="_5">所以，需要先判断：<strong>购物车中是否已经存在了该商品</strong>。<a class="headerlink" href="#_5" title="Permanent link"></a></h3>
<p>需要执行的SQL语句是：
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_cart</span> <span class="k">WHERE</span> <span class="n">uid</span><span class="o">=?</span> <span class="k">and</span> <span class="n">pid</span><span class="o">=?</span><span class="p">;</span>
</pre></div></p>
<h3 id="null">如果查询到的结果为<code>null</code>，说明购物车中不存在该商品。就需要插入新的购物车数据。<a class="headerlink" href="#null" title="Permanent link"></a></h3>
<div class="codehilite"><pre><span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">t_cart</span> 

<span class="k">VALUES</span> 
</pre></div>

<h3 id="null_1">如果查询到的结果不为<code>null</code>，说明购物车中之前已经添加了该商品，此时需要增加商品数量<a class="headerlink" href="#null_1" title="Permanent link"></a></h3>
<div class="codehilite"><pre><span class="k">UPDATE</span> <span class="n">t_cart</span> <span class="kt">SET</span> <span class="n">num</span><span class="o">=?</span><span class="p">,</span> <span class="n">modified_user</span><span class="o">=?</span><span class="p">,</span> <span class="n">modified_time</span><span class="o">=?</span> 
<span class="k">WHERE</span> <span class="n">cid</span><span class="o">=?</span>
</pre></div>

<h2 id="2_1">2. 设计抽象方法<a class="headerlink" href="#2_1" title="Permanent link"></a></h2>
<p>在<code>cn.tedu.store.mapper</code>中创建<code>CartMapper</code>接口，并添加抽象方法；
<div class="codehilite"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">CartMapper</span> <span class="o">{</span>
    <span class="cm">/**</span>
<span class="cm">     * 插入购物车数据</span>
<span class="cm">     */</span>
    <span class="n">Integer</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Cart</span> <span class="n">cart</span><span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * 修改购物车中商品的数量</span>
<span class="cm">     */</span>
    <span class="n">Integer</span> <span class="nf">updateNumByCid</span><span class="o">(</span>
        <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;cid&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">cid</span><span class="o">,</span>
        <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;num&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">num</span><span class="o">,</span>
        <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;modifiedUser&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">modifiedUser</span><span class="o">,</span>
        <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;modifiedTime&quot;</span><span class="o">)</span> <span class="n">Date</span> <span class="n">modifiedTime</span>
    <span class="o">);</span>

    <span class="cm">/**</span>
<span class="cm">     * 查询用户在购物车添加的某样商品的详情</span>
<span class="cm">     */</span>
    <span class="n">Cart</span> <span class="nf">findByUidAndPid</span><span class="o">(</span>
        <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;uid&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">uid</span><span class="o">,</span>
        <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;pid&quot;</span><span class="o">)</span> <span class="n">Integer</span> <span class="n">pid</span>
    <span class="o">);</span>   
<span class="o">}</span>
</pre></div></p>
<h2 id="3_1">3. 配置映射、测试映射<a class="headerlink" href="#3_1" title="Permanent link"></a></h2>
<p>在 <strong>src/main/resources/mappers/</strong> 下复制粘贴，得到 __CartMapper.xml__文件，在其中配置映射。
<div class="codehilite"><pre><span class="nt">&lt;mapper</span> <span class="na">namespace=</span><span class="s">&quot;cn.tedu.store.mapper.CartMapper&quot;</span><span class="nt">&gt;</span>

    <span class="c">&lt;!--  </span>
<span class="c">     * 插入购物车数据</span>
<span class="c">    Integer insert(Cart cart);</span>
<span class="c">    --&gt;</span>
    <span class="c">&lt;!-- cid是自动生成的 --&gt;</span>
    <span class="nt">&lt;insert</span> <span class="na">id=</span><span class="s">&quot;insert&quot;</span> <span class="na">useGeneratedKeys=</span><span class="s">&quot;true&quot;</span> <span class="na">keyProperty=</span><span class="s">&quot;cid&quot;</span><span class="nt">&gt;</span>
        INSERT INTO t_cart (
            uid, pid, num, price,
            created_user, created_time, modified_user, modified_time
        ) VALUES (
            #{uid}, #{pid}, #{num}, #{price},
            #{createdUser}, #{createdTime}, #{modifiedUser}, #{modifiedTime}
        );
    <span class="nt">&lt;/insert&gt;</span>

    <span class="c">&lt;!--  </span>
<span class="c">     * 修改购物车中商品的数量</span>
<span class="c">    Integer updateNumByCid(</span>
<span class="c">        @Param(&quot;cid&quot;) Integer cid,</span>
<span class="c">        @Param(&quot;num&quot;) Integer num,</span>
<span class="c">        @Param(&quot;modifiedUser&quot;) String modifiedUser,</span>
<span class="c">        @Param(&quot;modifiedTime&quot;) Date modifiedTime</span>
<span class="c">    );</span>
<span class="c">    --&gt;</span>
    <span class="nt">&lt;update</span> <span class="na">id=</span><span class="s">&quot;updateNumByCid&quot;</span><span class="nt">&gt;</span>
        UPDATE 
            t_cart
        SET 
            num=#{num},
            modified_user=#{modifiedUser},
            modified_time=#{modifiedTime},
        WHERE
            cid=#{cid}
    <span class="nt">&lt;/update&gt;</span>

    <span class="c">&lt;!--  </span>
<span class="c">     * 查询用户在购物车添加的某样商品的详情</span>
<span class="c">    Cart findByUidAndPid(</span>
<span class="c">        @Param(&quot;uid&quot;) Integer uid,</span>
<span class="c">        @Param(&quot;pid&quot;) Integer pid</span>
<span class="c">    ); </span>
<span class="c">    --&gt;</span>
    <span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findByUidAndPid&quot;</span> <span class="na">resultType=</span><span class="s">&quot;cn.tedu.store.entity.Cart&quot;</span><span class="nt">&gt;</span>
        SELECT * FROM t_cart WHEE uid=#{uid} AND pid=#{pid}
    <span class="nt">&lt;/select&gt;</span>
<span class="nt">&lt;/mapper&gt;</span>
</pre></div></p>
<h1 id="66-_1">66. 加入购物车-业务层<a class="headerlink" href="#66-_1" title="Permanent link"></a></h1>
<h1 id="-">作业： ------&gt; 显示购物车列表-持久层<a class="headerlink" href="#-" title="Permanent link"></a></h1>
<p>查询购物车列表，需要执行的SQL语句为：
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_cart</span> <span class="k">WHERE</span> <span class="n">uid</span> <span class="o">=</span> <span class="o">?</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div></p>
<blockquote>
<p>是根据添加日期，而不是修改日期来的。</p>
</blockquote>
<p>页面中需要显示图片等，所以需要<code>t_cart</code>关联<code>t_product</code>一起查询：
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_cart</span> 
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">t_product</span>
<span class="k">ON</span> <span class="n">t_cart</span><span class="p">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">t_product</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span> <span class="n">uid</span><span class="o">=?</span> 
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">created_time</span> <span class="k">DESC</span><span class="p">;</span>
</pre></div></p>
<p>对应</p>
<p>关联查询时并没有合适的实体类来封装查询结果，还需要创建专门的__Value Object__类来封装借查询结果。</p>
<ul>
<li>创建一个<code>CartVO</code>类:
<div class="codehilite"><pre>
</pre></div></li>
</ul>
<h1 id="-_1">确认订单页-显示勾选的购物车商品-持久层<a class="headerlink" href="#-_1" title="Permanent link"></a></h1>
<ol>
<li>规划SQL语句
用在购物车显示页面中勾选商品，选择结算，就会跳转到确认订单页面。
在__确认订单页面__中需要显示的有：收货地址和购物车数据。这些数据是从购物车页面传递过来的。
需要执行的SQL语句：
<div class="codehilite"><pre><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">t_cart</span> <span class="k">WHERE</span> <span class="n">cid</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">);</span>
</pre></div>
从购物车数据表中查询信息：
<div class="codehilite"><pre><span class="k">SELECT</span>
    <span class="n">cid</span><span class="p">,</span> <span class="n">uid</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">t_cart</span><span class="p">.</span><span class="n">num</span><span class="p">,</span> <span class="n">t_cart</span><span class="p">.</span><span class="n">price</span><span class="p">,</span>
    <span class="n">title</span><span class="p">,</span> <span class="n">iamge</span><span class="p">,</span> <span class="n">t_product</span><span class="p">.</span><span class="n">price</span> <span class="k">AS</span> <span class="n">realPrice</span>
<span class="k">FROM</span> 
    <span class="n">t_cart</span>
<span class="k">LEFT</span> <span class="k">JOIN</span>
    <span class="n">t_product</span>
<span class="k">ON</span>
    <span class="n">t_cart</span><span class="p">.</span><span class="n">pid</span> <span class="o">=</span> <span class="n">t_product</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span> 
    <span class="n">uid</span><span class="o">=</span><span class="c1">#{uid} AND cid IN (?,?)</span>
<span class="n">ORDERY</span> <span class="k">BY</span> 
    <span class="n">t_cart</span><span class="p">.</span><span class="n">created_time</span> <span class="k">DESC</span>
</pre></div></li>
<li>接口与抽象方法
在<code>CartMapper</code>中添加抽象方法:
<div class="codehilite"><pre><span class="n">List</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;</span> <span class="nf">findVOsByCids</span><span class="o">(</span>
    <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;uid&quot;</span><span class="o">)</span> <span class="n">uid</span><span class="o">,</span>
    <span class="nd">@Param</span><span class="o">(</span><span class="s">&quot;cids&quot;</span><span class="o">)</span> <span class="n">Integer</span><span class="o">[]</span> <span class="n">cids</span>
<span class="o">)</span>
</pre></div></li>
<li>配置映射
在__CartMapper.xml__中配置映射:
<div class="codehilite"><pre><span class="c">&lt;!-- List&lt;CartVO&gt; findVOsByCids --&gt;</span>
<span class="nt">&lt;select</span> <span class="na">id=</span><span class="s">&quot;findVOsByCids&quot;</span> <span class="na">resultType=</span><span class="s">&quot;cn.tedu.store.vo.CartVO&quot;</span><span class="nt">&gt;</span>
    SELECT 
        cid, uid, pid, t_cart.num, t_cart.price,
        title, t_product.price AS realPrice, image
    FROM 
        t_cart 
    LEFT JOIN
        t_product 
    ON 
        t_cart.pid=t_product.id 
    WHERE 
        uid=#{uid}
        AND 
        cid IN 
        <span class="nt">&lt;foreach</span> <span class="na">collection=</span><span class="s">&quot;cids&quot;</span> <span class="na">item=</span><span class="s">&quot;cid&quot;</span> <span class="na">separator=</span><span class="s">&quot;,&quot;</span> <span class="na">open=</span><span class="s">&quot;(&quot;</span> <span class="na">close=</span><span class="s">&quot;)&quot;</span><span class="nt">&gt;</span>
            #{cid}
        <span class="nt">&lt;/foreach&gt;</span>
    ORDER BY
        t_cart.created_time DESC
<span class="nt">&lt;/select&gt;</span>
</pre></div></li>
</ol>
<h1 id="83-">83.确定订单页-业务层<a class="headerlink" href="#83-" title="Permanent link"></a></h1>
<h2 id="_6">返回给页面订单商品信息<a class="headerlink" href="#_6" title="Permanent link"></a></h2>
<div class="codehilite"><pre>    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;</span> <span class="nf">getVOByCids</span><span class="o">(</span><span class="n">Integer</span> <span class="n">uid</span><span class="o">,</span> <span class="n">Integer</span><span class="o">[]</span> <span class="n">cids</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;</span> <span class="n">carts</span> <span class="o">=</span> <span class="n">cartMapper</span><span class="o">.</span><span class="na">findVOsByCids</span><span class="o">(</span><span class="n">uid</span><span class="o">,</span> <span class="n">cids</span><span class="o">);</span>
        <span class="n">Iterator</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">carts</span><span class="o">.</span><span class="na">iterator</span><span class="o">();</span>
        <span class="k">while</span><span class="o">(</span><span class="n">it</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">CartVO</span> <span class="n">cart</span> <span class="o">=</span> <span class="n">it</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(!</span><span class="n">cart</span><span class="o">.</span><span class="na">getUid</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">uid</span><span class="o">))</span> <span class="o">{</span>
                <span class="n">it</span><span class="o">.</span><span class="na">remove</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">carts</span><span class="o">.</span><span class="na">size</span><span class="o">()</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">CartNotFoundException</span><span class="o">(</span><span class="s">&quot;获取购物车数据失败！&quot;</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">carts</span><span class="o">;</span>
    <span class="o">}</span>
</pre></div>

<h1 id="84-">84. 确认订单页-控制器层<a class="headerlink" href="#84-" title="Permanent link"></a></h1>
<ol>
<li>业务分析：
- 请求路径：<code>/carts/selected</code>
- 请求参数：<code>Integer[] cids</code>,
- 使用Session获取uid：<code>HttpSession session</code>
- 请求方式：<code>GET</code>
- 响应数据:<code>JsonResult&lt;List&lt;CartVO&gt;&gt;</code></li>
<li>业务实现：
<div class="codehilite"><pre>    <span class="c1">// http://localhost:8080/carts/selected?cids=8&amp;cids=9</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">&quot;selected&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">JsonResult</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;&gt;</span> <span class="nf">getByCids</span><span class="o">(</span><span class="n">Integer</span><span class="o">[]</span> <span class="n">cids</span><span class="o">,</span> <span class="n">HttpSession</span> <span class="n">session</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">Integer</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">getUidFromSession</span><span class="o">(</span><span class="n">session</span><span class="o">);</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">CartVO</span><span class="o">&gt;</span> <span class="n">data</span> <span class="o">=</span> <span class="n">cartService</span><span class="o">.</span><span class="na">getVOByCids</span><span class="o">(</span><span class="n">uid</span><span class="o">,</span> <span class="n">cids</span><span class="o">);</span>
        <span class="k">return</span> <span class="k">new</span> <span class="n">JsonResult</span><span class="o">&lt;&gt;(</span><span class="n">SUCCESS</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
    <span class="o">}</span>
</pre></div><blockquote>
<p>如果url中存在多个同名的请求参数，SpringMVC框架会把这些参数的值封装为一个数组。
浏览器得到的Json数据为：
<div class="codehilite"><pre><span class="p">{</span><span class="nt">&quot;state&quot;</span><span class="p">:</span><span class="mi">2000</span><span class="p">,</span><span class="nt">&quot;data&quot;</span><span class="p">:[{</span><span class="nt">&quot;cid&quot;</span><span class="p">:</span><span class="mi">9</span><span class="p">,</span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span><span class="nt">&quot;pid&quot;</span><span class="p">:</span><span class="mi">10000003</span><span class="p">,</span><span class="nt">&quot;num&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span><span class="nt">&quot;realPrice&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;广博(GuangBo)16K115页线圈记事本子日记本文具笔记本图案随机&quot;</span><span class="p">,</span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="s2">&quot;/images/portal/01GuangBo16K115FB60506/&quot;</span><span class="p">},{</span><span class="nt">&quot;cid&quot;</span><span class="p">:</span><span class="mi">8</span><span class="p">,</span><span class="nt">&quot;uid&quot;</span><span class="p">:</span><span class="mi">35</span><span class="p">,</span><span class="nt">&quot;pid&quot;</span><span class="p">:</span><span class="mi">10000001</span><span class="p">,</span><span class="nt">&quot;num&quot;</span><span class="p">:</span><span class="mi">13</span><span class="p">,</span><span class="nt">&quot;price&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span><span class="nt">&quot;realPrice&quot;</span><span class="p">:</span><span class="mi">23</span><span class="p">,</span><span class="nt">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;广博(GuangBo)10本装40张A5牛皮纸记事本子日记本办公软抄本GBR0731&quot;</span><span class="p">,</span><span class="nt">&quot;image&quot;</span><span class="p">:</span><span class="s2">&quot;/images/portal/00GuangBo1040A5GBR0731/&quot;</span><span class="p">}]}</span>
</pre></div>
测试成功。</p>
</blockquote>
</li>
</ol>
<h1 id="85-">85. 确认订单页面-前端页面<a class="headerlink" href="#85-" title="Permanent link"></a></h1>
<h2 id="_7">需求分析：<a class="headerlink" href="#_7" title="Permanent link"></a></h2>
<ul>
<li>订单页面中显示收货地址的<code>&lt;option&gt;</code>组件:
    <div class="codehilite"><pre>八戒   家   北京市房山区高老庄3排6号   1380***1234
</pre></div></li>
<li>订单页面中显示购物车中选中的商品信息：<ul>
<li>在<code>orderConfirm.html</code>中，向<code>http://localhost:8080/carts/selected</code>发出请求，
并给出若干个<code>cids</code>的值，获取购物车的勾选数据，显示在确认订单页面中即可！</li>
</ul>
</li>
</ul>
<h2 id="_8">具体实现：<a class="headerlink" href="#_8" title="Permanent link"></a></h2>
<h3 id="1_1">1. 实现显示收货地址的功能:<a class="headerlink" href="#1_1" title="Permanent link"></a></h3>
<div class="codehilite"><pre><span class="c1">// 在上面的&lt;select&gt;标签上添加id属性，值为address-list。</span>
<span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">showAddressList</span><span class="p">();</span>
<span class="p">})</span> 
<span class="kd">function</span> <span class="nx">showAddressList</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#address-list&quot;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
        <span class="s2">&quot;url&quot;</span> <span class="o">:</span> <span class="s2">&quot;/addresses&quot;</span><span class="p">,</span>
        <span class="s2">&quot;type&quot;</span> <span class="o">:</span> <span class="s2">&quot;get&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dataType&quot;</span> <span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;success&quot;</span> <span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;count=&quot;</span> <span class="o">+</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;option value=&quot;#{aid}&quot;&gt;#{name}&amp;nbsp;&amp;nbsp;&amp;nbsp;#{tag}&amp;nbsp;&amp;nbsp;&amp;nbsp;#{province}#{area}#{address}&amp;nbsp;&amp;nbsp;&amp;nbsp;#{phone}&lt;/option&gt;&#39;</span><span class="p">;</span>
                <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{aid}/g</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">aid</span><span class="p">);</span>
                <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span>
                        <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{tag}/g</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">tag</span><span class="p">);</span>
                <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{name}/g</span><span class="p">,</span>
                        <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span><span class="p">);</span>
                <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{province}/g</span><span class="p">,</span>
                        <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">provinceName</span><span class="p">);</span>
                <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{area}/g</span><span class="p">,</span>
                        <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">areaName</span><span class="p">);</span>
                <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{address}/g</span><span class="p">,</span>
                        <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">address</span><span class="p">);</span>
                <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{phone}/g</span><span class="p">,</span>
                        <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">phone</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#address-list&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">})</span>  
<span class="p">}</span>
</pre></div>

<h3 id="_9">在确认订单页面中显示购物车中选中的商品信息<a class="headerlink" href="#_9" title="Permanent link"></a></h3>
<div class="codehilite"><pre><span class="kd">function</span> <span class="nx">showCartList</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#cart-list&quot;</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                <span class="s2">&quot;url&quot;</span><span class="o">:</span><span class="s2">&quot;/carts/selected&quot;</span><span class="p">,</span>
                <span class="s2">&quot;data&quot;</span><span class="o">:</span><span class="s2">&quot;cids=8&amp;cids=9&quot;</span><span class="p">,</span>
                <span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;get&quot;</span><span class="p">,</span>
                <span class="s2">&quot;dataType&quot;</span><span class="o">:</span><span class="s2">&quot;json&quot;</span><span class="p">,</span>
                <span class="s2">&quot;success&quot;</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">json</span><span class="p">)</span> <span class="p">{</span>

                    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;成功返回List:&quot;</span><span class="o">+</span><span class="nx">json</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">state</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;state == 2000&quot;</span><span class="p">);</span>
                        <span class="kd">var</span> <span class="nx">totalNum</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">totalPrice</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">cid</span><span class="p">);</span>
                            <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;tr&gt;&#39;</span>
                                <span class="o">+</span> <span class="s1">&#39;&lt;td&gt;&lt;img src=&quot;#{image}collect.png&quot; class=&quot;img-responsive&quot; /&gt;&lt;/td&gt;&#39;</span>
                                <span class="o">+</span> <span class="s1">&#39;&lt;td&gt;#{title}&lt;/td&gt;&#39;</span>
                                <span class="o">+</span> <span class="s1">&#39;&lt;td&gt;¥&lt;span&gt;#{realPrice}&lt;/span&gt;&lt;/td&gt;&#39;</span>
                                <span class="o">+</span> <span class="s1">&#39;&lt;td&gt;#{num}&lt;/td&gt;&#39;</span>
                                <span class="o">+</span> <span class="s1">&#39;&lt;td&gt;¥&lt;span&gt;#{totalPrice}&lt;/span&gt;&lt;/td&gt;&#39;</span>
                                <span class="o">+</span> <span class="s1">&#39;&lt;/tr&gt;&#39;</span><span class="p">;</span>

                            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{image}/g</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">image</span><span class="p">);</span>
                            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{title}/g</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">title</span><span class="p">);</span>
                            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{realPrice}/g</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">realPrice</span><span class="p">);</span>
                            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{num}/g</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">num</span><span class="p">);</span>
                            <span class="nx">html</span> <span class="o">=</span> <span class="nx">html</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#{totalPrice}/g</span><span class="p">,</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">realPrice</span> <span class="o">*</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">num</span><span class="p">);</span>

                            <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#cart-list&quot;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
                            <span class="nx">totalNum</span> <span class="o">+=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">num</span><span class="p">;</span>
                            <span class="nx">totalPrice</span> <span class="o">+=</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">realPrice</span> <span class="o">*</span> <span class="nx">json</span><span class="p">.</span><span class="nx">data</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">num</span><span class="p">;</span>
                        <span class="p">}</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#totalNum&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">totalNum</span><span class="p">);</span>
                        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#totalPrice&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">totalPrice</span><span class="p">);</span>

                    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">alert</span><span class="p">(</span><span class="nx">json</span><span class="p">.</span><span class="nx">message</span><span class="p">);</span>

                    <span class="p">}</span>

                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
</pre></div>

<h1 id="_10">购物车页面传给确认订单页面购物车数据<a class="headerlink" href="#_10" title="Permanent link"></a></h1>
<h2 id="_11">购物车页面：<a class="headerlink" href="#_11" title="Permanent link"></a></h2>
<ul>
<li>给复选框添加<code>name="cids"</code>和<code>value=#{cid}</code>属性.</li>
<li>用__Form表单__提交勾选的<code>cid</code>，<code>action</code>属性设置为<code>orderConfirm.html</code>，<code>method</code>为<code>GET</code>.</li>
<li>结算按钮的类型改成<code>submit</code>.
这样一来，点击__结算__按钮，就会发出<code>orderConfirm.html?cids=8&amp;cids=9</code>的GET请求.
跳转到<code>orderConfirm.html</code>页面。</li>
</ul>
<h2 id="_12">确认订单页面：<a class="headerlink" href="#_12" title="Permanent link"></a></h2>
<p>从url中获取参数：<code>"data":location.search.substr(1)</code>;</p>
<h1 id="jquery">jQuery中设置值和取值的函数<a class="headerlink" href="#jquery" title="Permanent link"></a></h1>
<ul>
<li><code>val()</code>：设置/获取值</li>
<li><code>html()</code>：设置/获取标签的子级HTML代码</li>
<li><code>append()</code>：向某个标签的子级追加HTML代码</li>
<li><code>empty()</code>：将某个标签的自己内容全部删除</li>
<li><code>attr()</code>: 获取/设置某个标签的某个属性的值,例如<img>标签的<code>src</code>属性；</li>
<li><code>prop()</code>: 获取/设置某个标签对象的JS属性的值；<code>readonly="readonly", check="checke"</code></li>
</ul>
<h1 id="83">83. 创建订单数据表<a class="headerlink" href="#83" title="Permanent link"></a></h1>
<ol>
<li>订单表
<div class="codehilite"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">t_order</span> 
<span class="p">(</span>
    <span class="n">oid</span> <span class="kt">INT</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="kp">AUTO_INCREMENT</span> <span class="n">COMMENT</span> <span class="s2">&quot;订单id&quot;</span><span class="p">,</span>
    <span class="n">uid</span> <span class="kt">INT</span> <span class="n">COMMENT</span> <span class="s2">&quot;用户id&quot;</span><span class="p">,</span>
    <span class="n">recv_name</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;收货人姓名&quot;</span><span class="p">,</span>
    <span class="n">recv_province</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="n">COMMENT</span>  <span class="s2">&quot;收货省&quot;</span><span class="p">,</span>
    <span class="n">recv_city</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;收货市&quot;</span><span class="p">,</span>
    <span class="n">recv_area</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;收货区县&quot;</span><span class="p">,</span>
    <span class="n">recv_address</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;详细地址&quot;</span><span class="p">,</span>
    <span class="n">payment_amount</span> <span class="kt">BIGINT</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;支付金额&quot;</span><span class="p">,</span>
    <span class="n">status</span> <span class="kt">INT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;订单状态:0-未支付，1-已支付，2-已取消，3-已关闭&quot;</span><span class="p">,</span>
    <span class="n">order_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s2">&quot;下单时间&quot;</span><span class="p">,</span>
    <span class="n">pay_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s2">&quot;支付时间&quot;</span><span class="p">,</span>
    <span class="n">created_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;创建用户&quot;</span><span class="p">,</span>
    <span class="n">created_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s2">&quot;创建时间&quot;</span><span class="p">,</span>
    <span class="n">modified_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;修改用户&quot;</span><span class="p">,</span>
    <span class="n">modified_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s2">&quot;修改时间&quot;</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">oid</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="kp">CHARSET</span> <span class="o">=</span> <span class="n">utf8mb4</span><span class="p">;</span>
</pre></div></li>
<li>订单商品表
<div class="codehilite"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nf">t_order_item</span> 
<span class="p">(</span>
    <span class="n">id</span> <span class="kt">INT</span> <span class="n">AUTO_INCREEMNT</span> <span class="n">COMMENT</span> <span class="s2">&quot;订单商品id&quot;</span><span class="p">,</span>
    <span class="n">oid</span> <span class="kt">INT</span> <span class="n">COMMENT</span>  <span class="s2">&quot;订单id&quot;</span><span class="p">,</span>
    <span class="n">pid</span> <span class="kt">INT</span> <span class="n">COMMENT</span> <span class="s2">&quot;商品id&quot;</span><span class="p">,</span>
    <span class="n">title</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;商品标题&quot;</span><span class="p">,</span>
    <span class="n">image</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;商品图片&quot;</span><span class="p">,</span>
    <span class="n">price</span> <span class="kt">BIGINT</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;商品单价&quot;</span><span class="p">,</span>
    <span class="n">num</span> <span class="kt">INT</span> <span class="n">COMMENT</span> <span class="s2">&quot;购买数量&quot;</span><span class="p">,</span>
    <span class="n">total_price</span> <span class="kt">BIGINT</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;商品总价&quot;</span><span class="p">,</span>
    <span class="n">created_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;创建用户&quot;</span><span class="p">,</span>
    <span class="n">created_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s2">&quot;创建时间&quot;</span><span class="p">,</span>
    <span class="n">modified_user</span> <span class="kt">VARCHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="n">COMMENT</span> <span class="s2">&quot;修改用户&quot;</span><span class="p">,</span>
    <span class="n">modified_time</span> <span class="kt">DATETIME</span> <span class="n">COMMENT</span> <span class="s2">&quot;修改时间&quot;</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span> <span class="k">DEFAULT</span> <span class="kp">CHARSET</span> <span class="o">=</span> <span class="n">utf8mb4</span><span class="p">;</span>
</pre></div></li>
</ol>
<h1 id="84">84. 创建订单实体类<a class="headerlink" href="#84" title="Permanent link"></a></h1>
<ol>
<li>订单类<code>cn.tedu.store.entity.Order</code>:
<div class="codehilite"><pre>
</pre></div></li>
<li>订单商品类<code>cn.tedu.store.entity.OrderItem</code>:
<div class="codehilite"><pre>
</pre></div></li>
</ol>
<h1 id="85">85. 订单持久层<a class="headerlink" href="#85" title="Permanent link"></a></h1>
<p>创建一个处理订单数据的持久层接口，添加抽象方法：
<div class="codehilite"><pre><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">OrderMapper</span> <span class="o">{</span>
    <span class="n">Integer</span> <span class="nf">insert</span><span class="o">(</span><span class="n">Order</span> <span class="n">order</span><span class="o">);</span>
    <span class="n">Integer</span> <span class="nf">insert</span><span class="o">(</span><span class="n">OrderItem</span> <span class="n">orderItem</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
复制得到</p></article></body></html>